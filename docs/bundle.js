(()=>{"use strict";function e(e){for(var n=e._nowObject.now(),t=n+e._skipFramesAfter,r=1e3/e.tickRate;e._lastTick+r<n;)if(e.onTick(r),e._lastTick+=r,(n=e._nowObject.now())>t)return void(e._lastTick=n)}function n(n){requestAnimationFrame(n._frameCB),e(n);var t=n._nowObject.now(),r=t-n._lastRender;if(n._lastRender=t,n.maxRenderRate>0){n._renderAccum+=r;var o=1e3/n.maxRenderRate;if(n._renderAccum<o)return;n._renderAccum=Math.min(n._renderAccum-o,o)}var i=1e3/n.tickRate,c=(t-n._lastTick)/i;n.onRender(r,c,i)}var t=document.querySelector.bind(document),r=t(".game"),o=new class{constructor(t=null,r=10,o=100){this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(e){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(e){},this.onFullscreenChanged=function(e){},(e=>{if("loading"===document.readyState){var n=()=>{document.removeEventListener("readystatechange",n),e()};document.addEventListener("readystatechange",n)}else setTimeout(e,1)})((()=>{!function(t,r,o){t._nowObject=performance||Date,t._skipFramesAfter=o,t._renderAccum=0;var i=t._nowObject.now();t._lastTick=i,t._lastRender=i,t._frameCB=n.bind(null,t),requestAnimationFrame(t._frameCB),r>0&&(t._intervalCB=e.bind(null,t),t._interval=setInterval(t._intervalCB,r))}(this,r,o),function(e,n){if(n){var t=!1,r=!1,o=e=>{n.requestPointerLock&&!!e!==t&&(e?n.requestPointerLock():document.exitPointerLock())},i=e=>{n.requestFullscreen&&!!e!==r&&(e?n.requestFullscreen():document.exitFullscreen())};document.addEventListener("pointerlockchange",(r=>{t=document.pointerLockElement===n,e.onPointerLockChanged(t)})),document.addEventListener("fullscreenchange",(t=>{r=document.fullscreenElement===n,e.onFullscreenChanged(r)})),Object.defineProperty(e,"pointerLock",{get:()=>t,set:o}),Object.defineProperty(e,"fullscreen",{get:()=>r,set:i}),n.addEventListener("click",(n=>{e.stickyPointerLock&&!t&&o(!0),e.stickyFullscreen&&!r&&i(!0)}));var c=()=>e.onResize();window.ResizeObserver?new ResizeObserver(c).observe(n):window.addEventListener("resize",c)}}(this,t),this.onInit()}))}}(r,15),i=0,c=0;function a(e,n){var r=t(e);r.oninput=e=>{var t=parseInt(e.target.value);n(isNaN(t)?e.target.checked:t)},setTimeout((()=>{var e=parseInt(r.value);n(isNaN(e)?r.checked:e)}),1)}a("#PL",(e=>{o.stickyPointerLock=e})),a("#FS",(e=>{o.stickyFullscreen=e})),a("#TR",(e=>{o.tickRate=e})),a("#MRR",(e=>{o.maxRenderRate=e})),a("#WTT",(e=>{i=e})),a("#WTR",(e=>{c=e})),t(".spike").onclick=function(){for(var e=performance.now()+500;performance.now()<e;);};var s=F(),l=1,u=0;o.onTick=e=>{if(v){var n=performance.now();console.log("  tick","dt",n-u,"dur",e),u=n}var r;(R+=600*(r=e)/1e3)>_&&(R-=_),(w+=50*r/1e3)>g&&(w-=g);var o=s();0==--l&&(t("#OTR").textContent=Math.round(o),l=m(o));for(var c=performance.now()+i;performance.now()<c;);};var d=F(),f=1;o.onRender=(e,n,r)=>{if(v){var o=n*r;console.log("render","dt",e,"part",n,"ms in:",o)}!function(e,n){var t=(R+e*(p*n/1e3))%_,r=w+e*(50*n/1e3);if(0===L)T(1),C(t,30,40,40);else if(1===L){T(y++%10==0?.15:.05);C(t,r,2,30),r>g-30&&C(t,r-g,2,30)}else{var o=t-b;o<-_/2&&(o+=_),b=t,T(.02),h.globalCompositeOperation="copy",h.drawImage(h.canvas,-o,0),h.globalCompositeOperation="source-over",C(_-15,10,1,g-20)}}(n,r);var i=d();0==--f&&(t("#OFR").textContent=Math.round(i),f=m(i));for(var a=performance.now()+c;performance.now()<a;);};var m=e=>Math.ceil(e/5),v=!1;document.addEventListener("keydown",(e=>{"p"===e.key&&(v=!v)}));var k=t(".output"),h=k.getContext("2d"),R=0,p=600,w=0,_=k.width,g=k.height,L=0;k.onclick=()=>{L=(L+1)%3};var y=0,b=0,T=e=>{h.fillStyle=`rgba(255,255,255, ${e})`,h.fillRect(0,0,_,g)},C=(e,n,t,r)=>{h.fillStyle="red",h.fillRect(e,n,t,r)};function F(){var e=0,n=10;return()=>{var t=performance.now(),r=t-e;return e=t,1e3/(n=.95*n+r*(1-.95))}}})();